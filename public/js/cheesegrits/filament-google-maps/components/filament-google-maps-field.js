function oe(s,c){s.src=c}var ae=s=>{var c,r,T,d="The Google Maps JavaScript API",h="google",y="importLibrary",C="__ib__",v=document,w=window,P=w[h]||(w[h]={}),g=P.maps||(P.maps={}),S=new Set,u=new URLSearchParams,M=()=>c||(c=new Promise(async(m,L)=>{await(r=v.createElement("script")),u.set("libraries",[...S]+"");for(T in s)u.set(T.replace(/[A-Z]/g,N=>"_"+N[0].toLowerCase()),s[T]);u.set("callback",h+".maps."+C),oe(r,"https://maps.googleapis.com/maps/api/js?"+u),g[C]=m,r.onerror=()=>c=L(Error(d+" could not load.")),r.nonce=v.querySelector("script[nonce]")?.nonce||"",v.head.append(r)}));g[y]?console.warn(d+" only loads once. Ignoring:",s):g[y]=(m,...L)=>S.add(m)&&M().then(()=>g[y](m,...L))};var se=s=>`The setOptions() function should only be called once. The options passed to the additional call (${JSON.stringify(s)}) will be ignored.`,ie=s=>`The google.maps.importLibrary() function is already defined, and @googlemaps/js-api-loader will use the existing function instead of overwriting it. The options passed to setOptions (${JSON.stringify(s)}) will be ignored.`,ne="No options were set before calling importLibrary. Make sure to configure the loader using setOptions().",re="There already is a script loading the Google Maps JavaScript API, and no google.maps.importLibrary function is defined. @googlemaps/js-api-loader will proceed to bootstrap the API with the specified options, but the existing script might cause problems using the API. Make sure to remove the script loading the API.",K=!1,B=K?s=>{console.warn(`[@googlemaps/js-api-loader] ${s}`)}:()=>{},le=K?s=>{console.info(`[@googlemaps/js-api-loader] ${s}`)}:()=>{};var ce=!1,x=!1;function V(s){if(x){B(se(s));return}pe(s),x=!0}async function D(s){if(x||B(ne),!window?.google?.maps?.importLibrary)throw new Error("google.maps.importLibrary is not installed.");return await google.maps.importLibrary(s)}function pe(s){let c=!!window.google?.maps?.importLibrary;c?le(ie(s)):ce&&document.querySelector('script[src*="maps.googleapis.com/maps/api/js"]')&&B(re),c||ae(s)}function de({apiKey:s,state:c,setStateUsing:r,getStateUsing:T,autocomplete:d,autocompleteReverse:h,geolocate:y=!1,geolocateOnLoad:C,geolocateLabel:v,draggable:w,clickable:P,defaultLocation:g,statePath:S,controls:u,kmlLayers:M,reverseGeocodeFields:m,defaultZoom:L,types:N,countries:q,placeField:R,debug:z,mapEl:W,pacEl:X,geoJson:E,geoJsonField:k,geoJsonProperty:A,geoJsonVisible:Y,reverseGeocodeUsing:Z,placeUpdatedUsing:F,hasReverseGeocodeUsing:$=!1,hasPlaceUpdatedUsing:I=!1,mapType:H="roadmap"}){let l=null,b=null,G=null,p=null,Q=null,j={"%n":["street_number"],"%z":["postal_code"],"%S":["street_address","route"],"%A1":["administrative_area_level_1"],"%A2":["administrative_area_level_2"],"%A3":["administrative_area_level_3"],"%A4":["administrative_area_level_4"],"%A5":["administrative_area_level_5"],"%a1":["administrative_area_level_1"],"%a2":["administrative_area_level_2"],"%a3":["administrative_area_level_3"],"%a4":["administrative_area_level_4"],"%a5":["administrative_area_level_5"],"%L":["locality","postal_town"],"%D":["sublocality"],"%C":["country"],"%c":["country"],"%p":["premise"],"%P":["premise"],"%sp":["subpremise","route"],"%SP":["subpremise","route"]},O=null,J=null,_=[];return{state:c,init:function(){this.createMap()},async createMap(){V({key:s});let{Map:o}=await D("maps"),{PlacesService:t}=await D("places"),{AdvancedMarkerElement:n}=await D("marker");if((h||Object.keys(m).length>0)&&(G=new google.maps.Geocoder),l=new o(W,{mapId:S,center:this.getCoordinates(),zoom:L,mapTypeId:google.maps.MapTypeId[H.toUpperCase()],...u}),b=new n({gmpDraggable:w,position:this.getCoordinates(),map:l}),P&&l.addListener("click",e=>{this.markerMoved(e)}),w&&google.maps.event.addListener(b,"dragend",e=>{this.markerMoved(e)}),u.searchBoxControl){let e=X,a=new google.maps.places.SearchBox(e);l.controls[google.maps.ControlPosition.TOP_LEFT].push(e),a.addListener("places_changed",()=>{e.value="",p=a.getPlaces()[0].geometry.location})}if(I&&(J=new google.maps.places.PlacesService(l)),_=["address_components","formatted_address","geometry","name"],_.includes(R)||_.push(R),I&&_.push("photos"),d){let e=document.getElementById(d);if(e){window.addEventListener("keydown",function(i){if((i.key==="U+000A"||i.key==="Enter"||i.code==="Enter")&&i.target.nodeName==="INPUT"&&i.target.type==="text")return i.preventDefault(),!1},!0);let a={fields:_,strictBounds:!1,types:N},f=new google.maps.places.Autocomplete(e,a);f.setComponentRestrictions({country:q}),f.addListener("place_changed",()=>{let i=f.getPlace();if(!i.geometry||!i.geometry.location){window.alert("No details available for input: '"+i.name+"'");return}i.geometry.viewport?l.fitBounds(i.geometry.viewport):l.setCenter(i.geometry.location),r(d,i[R]),b.position=i.geometry.location,p=i.geometry.location,this.setCoordinates(i.geometry.location),this.updateGeocodeFromAddressComponents(i.address_components),I&&F(i)})}}if(M&&(Q=M.map(e=>{new google.maps.KmlLayer({url:e,map:l}).addListener("click",f=>{let i=f.featureData.description})})),E&&(Y?O=l.data:O=new google.maps.Data,/^http/.test(E)?O.loadGeoJson(E):O.addGeoJson(JSON.parse(E))),C&&this.getLocation(),y&&"geolocation"in navigator){let e=document.createElement("button");e.textContent=v,e.classList.add("custom-map-control-button"),l.controls[google.maps.ControlPosition.TOP_CENTER].push(e),e.addEventListener("click",a=>{a.preventDefault(),this.getLocation()})}this.$watch("state",()=>{if(this.state===void 0)return;let e=this.getCoordinates(),a=b.position;e.lat===a.lat&&e.lng===a.lng||(this.updateAutocompleteFromLocation(e),this.updateMap(e))})},markerMoved:function(o){this.geoJsonContains(o.latLng),p=o.latLng.toJSON(),this.setCoordinates(p),this.updateFromLocation(p),l.panTo(p),I&&o.placeId&&J.getDetails({placeId:o.placeId,fields:_},(t,n)=>{n==="OK"&&F(t)})},updateMap:function(o){b.position=o,l.panTo(o)},updateFromLocation:function(o){(this.hasReverseGeocode()||this.hasReverseAutocomplete())&&G.geocode({location:o}).then(t=>{this.updateGeocodeFromAddressComponents(t.results[0].address_components),this.updateAutocompleteFromFormattedAddress(t.results[0].formatted_address),$&&Z(t)}).catch(t=>{console.log(t.message)})},updateGeocodeFromAddressComponents:function(o){if(this.hasReverseGeocode()){let t=this.getReplacements(o);for(let n in m){let e=m[n];for(let a in t)e=e.split(a).join(t[a]);for(let a in j)e=e.split(a).join("");e=e.trim(),r(n,e)}}},updateGeocodeFromLocation:function(o){this.hasReverseGeocode()&&G.geocode({location:o}).then(t=>t.results[0].address_components).then(t=>this.updateGeocodeFromAddressComponents(t)).catch(t=>{console.log(t.message)})},updateAutocompleteFromFormattedAddress:function(o){this.hasReverseAutocomplete()&&r(d,o)},updateAutocompleteFromLocation:function(o){this.hasReverseAutocomplete()&&G.geocode({location:o}).then(t=>{t.results[0]&&r(d,t.results[0].formatted_address)}).catch(t=>{console.log(t.message)})},hasReverseAutocomplete:function(){return d&&h},hasReverseGeocode:function(){return Object.keys(m).length>0||$},setCoordinates:function(o){this.state=o},getCoordinates:function(){return(this.state===null||!this.state.hasOwnProperty("lat"))&&(this.state={lat:g.lat,lng:g.lng}),this.state},getLocation:function(){navigator.geolocation.getCurrentPosition(o=>{p={lat:o.coords.latitude,lng:o.coords.longitude},this.setCoordinates(p),this.updateFromLocation(p),l.panTo(p)})},getReplacements:function(o){let t={};return o.forEach(n=>{for(let e in j)j[e].indexOf(n.types[0])!==-1&&(e===e.toLowerCase()?t[e]=n.short_name:t[e]=n.long_name)}),z&&console.log(t),t},geoJsonContains:function(o){if(E&&k){let t=[],n=new google.maps.Data;O.forEach(a=>{if(a.getGeometry().getType()==="Polygon"){var f=new google.maps.Polygon({path:a.getGeometry().getAt(0).getArray()});google.maps.geometry.poly.containsLocation(o,f)&&(A?t.push(a.getProperty(A)):n.add(a))}a.getGeometry().getType()==="MultiPolygon"&&a.getGeometry().getArray().forEach(function(U,me){let ee=U.getAt(0).getArray(),te=new google.maps.Polygon({paths:ee});google.maps.geometry.poly.containsLocation(o,te)&&(A?t.push(a.getProperty(A)):n.add(a))})});let e;A?(e=JSON.stringify(t),r(k,e)):n.toGeoJson(a=>{e=JSON.stringify(a),r(k,e)})}}}}export{de as default};
