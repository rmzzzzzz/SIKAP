var{getOwnPropertyNames:At,getOwnPropertySymbols:vt}=Object,{hasOwnProperty:kt}=Object.prototype;function G(s,t){return function(e,n,o){return s(e,n,o)&&t(e,n,o)}}function q(s){return function(r,e,n){if(!r||!e||typeof r!="object"||typeof e!="object")return s(r,e,n);let{cache:o}=n,a=o.get(r),c=o.get(e);if(a&&c)return a===e&&c===r;o.set(r,e),o.set(e,r);let i=s(r,e,n);return o.delete(r),o.delete(e),i}}function Pt(s){return s?.[Symbol.toStringTag]}function at(s){return At(s).concat(vt(s))}var xt=Object.hasOwn||((s,t)=>kt.call(s,t));function L(s,t){return s===t||!s&&!t&&s!==s&&t!==t}var Tt="__v",Lt="__o",Ot="_owner",{getOwnPropertyDescriptor:ct,keys:lt}=Object;function Ct(s,t){return s.byteLength===t.byteLength&&B(new Uint8Array(s),new Uint8Array(t))}function bt(s,t,r){let e=s.length;if(t.length!==e)return!1;for(;e-- >0;)if(!r.equals(s[e],t[e],e,e,s,t,r))return!1;return!0}function St(s,t){return s.byteLength===t.byteLength&&B(new Uint8Array(s.buffer,s.byteOffset,s.byteLength),new Uint8Array(t.buffer,t.byteOffset,t.byteLength))}function It(s,t){return L(s.getTime(),t.getTime())}function jt(s,t){return s.name===t.name&&s.message===t.message&&s.cause===t.cause&&s.stack===t.stack}function Dt(s,t){return s===t}function ut(s,t,r){let e=s.size;if(e!==t.size)return!1;if(!e)return!0;let n=new Array(e),o=s.entries(),a,c,i=0;for(;(a=o.next())&&!a.done;){let p=t.entries(),f=!1,h=0;for(;(c=p.next())&&!c.done;){if(n[h]){h++;continue}let d=a.value,l=c.value;if(r.equals(d[0],l[0],i,h,s,t,r)&&r.equals(d[1],l[1],d[0],l[0],s,t,r)){f=n[h]=!0;break}h++}if(!f)return!1;i++}return!0}var Rt=L;function qt(s,t,r){let e=lt(s),n=e.length;if(lt(t).length!==n)return!1;for(;n-- >0;)if(!ft(s,t,r,e[n]))return!1;return!0}function b(s,t,r){let e=at(s),n=e.length;if(at(t).length!==n)return!1;let o,a,c;for(;n-- >0;)if(o=e[n],!ft(s,t,r,o)||(a=ct(s,o),c=ct(t,o),(a||c)&&(!a||!c||a.configurable!==c.configurable||a.enumerable!==c.enumerable||a.writable!==c.writable)))return!1;return!0}function Bt(s,t){return L(s.valueOf(),t.valueOf())}function Nt(s,t){return s.source===t.source&&s.flags===t.flags}function ht(s,t,r){let e=s.size;if(e!==t.size)return!1;if(!e)return!0;let n=new Array(e),o=s.values(),a,c;for(;(a=o.next())&&!a.done;){let i=t.values(),p=!1,f=0;for(;(c=i.next())&&!c.done;){if(!n[f]&&r.equals(a.value,c.value,a.value,c.value,s,t,r)){p=n[f]=!0;break}f++}if(!p)return!1}return!0}function B(s,t){let r=s.byteLength;if(t.byteLength!==r||s.byteOffset!==t.byteOffset)return!1;for(;r-- >0;)if(s[r]!==t[r])return!1;return!0}function Zt(s,t){return s.hostname===t.hostname&&s.pathname===t.pathname&&s.protocol===t.protocol&&s.port===t.port&&s.hash===t.hash&&s.username===t.username&&s.password===t.password}function ft(s,t,r,e){return(e===Ot||e===Lt||e===Tt)&&(s.$$typeof||t.$$typeof)?!0:xt(t,e)&&r.equals(s[e],t[e],e,e,s,t,r)}var Ft="[object ArrayBuffer]",Ut="[object Arguments]",Gt="[object Boolean]",zt="[object DataView]",$t="[object Date]",Vt="[object Error]",Wt="[object Map]",Kt="[object Number]",Jt="[object Object]",Yt="[object RegExp]",Ht="[object Set]",Xt="[object String]",Qt={"[object Int8Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Int16Array]":!0,"[object Uint16Array]":!0,"[object Int32Array]":!0,"[object Uint32Array]":!0,"[object Float16Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0,"[object BigInt64Array]":!0,"[object BigUint64Array]":!0},te="[object URL]",ee=Object.prototype.toString;function re({areArrayBuffersEqual:s,areArraysEqual:t,areDataViewsEqual:r,areDatesEqual:e,areErrorsEqual:n,areFunctionsEqual:o,areMapsEqual:a,areNumbersEqual:c,areObjectsEqual:i,arePrimitiveWrappersEqual:p,areRegExpsEqual:f,areSetsEqual:h,areTypedArraysEqual:d,areUrlsEqual:l,unknownTagComparators:m}){return function(u,g,y){if(u===g)return!0;if(u==null||g==null)return!1;let E=typeof u;if(E!==typeof g)return!1;if(E!=="object")return E==="number"?c(u,g,y):E==="function"?o(u,g,y):!1;let M=u.constructor;if(M!==g.constructor)return!1;if(M===Object)return i(u,g,y);if(Array.isArray(u))return t(u,g,y);if(M===Date)return e(u,g,y);if(M===RegExp)return f(u,g,y);if(M===Map)return a(u,g,y);if(M===Set)return h(u,g,y);let _=ee.call(u);if(_===$t)return e(u,g,y);if(_===Yt)return f(u,g,y);if(_===Wt)return a(u,g,y);if(_===Ht)return h(u,g,y);if(_===Jt)return typeof u.then!="function"&&typeof g.then!="function"&&i(u,g,y);if(_===te)return l(u,g,y);if(_===Vt)return n(u,g,y);if(_===Ut)return i(u,g,y);if(Qt[_])return d(u,g,y);if(_===Ft)return s(u,g,y);if(_===zt)return r(u,g,y);if(_===Gt||_===Kt||_===Xt)return p(u,g,y);if(m){let k=m[_];if(!k){let v=Pt(u);v&&(k=m[v])}if(k)return k(u,g,y)}return!1}}function se({circular:s,createCustomConfig:t,strict:r}){let e={areArrayBuffersEqual:Ct,areArraysEqual:r?b:bt,areDataViewsEqual:St,areDatesEqual:It,areErrorsEqual:jt,areFunctionsEqual:Dt,areMapsEqual:r?G(ut,b):ut,areNumbersEqual:Rt,areObjectsEqual:r?b:qt,arePrimitiveWrappersEqual:Bt,areRegExpsEqual:Nt,areSetsEqual:r?G(ht,b):ht,areTypedArraysEqual:r?G(B,b):B,areUrlsEqual:Zt,unknownTagComparators:void 0};if(t&&(e=Object.assign({},e,t(e))),s){let n=q(e.areArraysEqual),o=q(e.areMapsEqual),a=q(e.areObjectsEqual),c=q(e.areSetsEqual);e=Object.assign({},e,{areArraysEqual:n,areMapsEqual:o,areObjectsEqual:a,areSetsEqual:c})}return e}function ne(s){return function(t,r,e,n,o,a,c){return s(t,r,c)}}function oe({circular:s,comparator:t,createState:r,equals:e,strict:n}){if(r)return function(c,i){let{cache:p=s?new WeakMap:void 0,meta:f}=r();return t(c,i,{cache:p,equals:e,meta:f,strict:n})};if(s)return function(c,i){return t(c,i,{cache:new WeakMap,equals:e,meta:void 0,strict:n})};let o={cache:void 0,equals:e,meta:void 0,strict:n};return function(c,i){return t(c,i,o)}}var z=P(),ve=P({strict:!0}),ke=P({circular:!0}),Pe=P({circular:!0,strict:!0}),xe=P({createInternalComparator:()=>L}),Te=P({strict:!0,createInternalComparator:()=>L}),Le=P({circular:!0,createInternalComparator:()=>L}),Oe=P({circular:!0,createInternalComparator:()=>L,strict:!0});function P(s={}){let{circular:t=!1,createInternalComparator:r,createState:e,strict:n=!1}=s,o=se(s),a=re(o),c=r?r(a):ne(a);return oe({circular:t,comparator:a,createState:e,equals:c,strict:n})}var pt=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],$=1,S=8,j=class s{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[r,e]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");let n=e>>4;if(n!==$)throw new Error(`Got v${n} data when expected v${$}.`);let o=pt[e&15];if(!o)throw new Error("Unrecognized array type.");let[a]=new Uint16Array(t,2,1),[c]=new Uint32Array(t,4,1);return new s(c,a,o,t)}constructor(t,r=64,e=Float64Array,n){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=e,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let o=pt.indexOf(this.ArrayType),a=t*2*this.ArrayType.BYTES_PER_ELEMENT,c=t*this.IndexArrayType.BYTES_PER_ELEMENT,i=(8-c%8)%8;if(o<0)throw new Error(`Unexpected typed array class: ${e}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,S,t),this.coords=new this.ArrayType(this.data,S+c+i,t*2),this._pos=t*2,this._finished=!0):(this.data=new ArrayBuffer(S+a+c+i),this.ids=new this.IndexArrayType(this.data,S,t),this.coords=new this.ArrayType(this.data,S+c+i,t*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,($<<4)+o]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){let e=this._pos>>1;return this.ids[e]=e,this.coords[this._pos++]=t,this.coords[this._pos++]=r,e}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return W(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,e,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:o,coords:a,nodeSize:c}=this,i=[0,o.length-1,0],p=[];for(;i.length;){let f=i.pop()||0,h=i.pop()||0,d=i.pop()||0;if(h-d<=c){for(let u=d;u<=h;u++){let g=a[2*u],y=a[2*u+1];g>=t&&g<=e&&y>=r&&y<=n&&p.push(o[u])}continue}let l=d+h>>1,m=a[2*l],w=a[2*l+1];m>=t&&m<=e&&w>=r&&w<=n&&p.push(o[l]),(f===0?t<=m:r<=w)&&(i.push(d),i.push(l-1),i.push(1-f)),(f===0?e>=m:n>=w)&&(i.push(l+1),i.push(h),i.push(1-f))}return p}within(t,r,e){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:n,coords:o,nodeSize:a}=this,c=[0,n.length-1,0],i=[],p=e*e;for(;c.length;){let f=c.pop()||0,h=c.pop()||0,d=c.pop()||0;if(h-d<=a){for(let u=d;u<=h;u++)dt(o[2*u],o[2*u+1],t,r)<=p&&i.push(n[u]);continue}let l=d+h>>1,m=o[2*l],w=o[2*l+1];dt(m,w,t,r)<=p&&i.push(n[l]),(f===0?t-e<=m:r-e<=w)&&(c.push(d),c.push(l-1),c.push(1-f)),(f===0?t+e>=m:r+e>=w)&&(c.push(l+1),c.push(h),c.push(1-f))}return i}};function W(s,t,r,e,n,o){if(n-e<=r)return;let a=e+n>>1;gt(s,t,a,e,n,o),W(s,t,r,e,a-1,1-o),W(s,t,r,a+1,n,1-o)}function gt(s,t,r,e,n,o){for(;n>e;){if(n-e>600){let p=n-e+1,f=r-e+1,h=Math.log(p),d=.5*Math.exp(2*h/3),l=.5*Math.sqrt(h*d*(p-d)/p)*(f-p/2<0?-1:1),m=Math.max(e,Math.floor(r-f*d/p+l)),w=Math.min(n,Math.floor(r+(p-f)*d/p+l));gt(s,t,r,m,w,o)}let a=t[2*r+o],c=e,i=n;for(I(s,t,e,r),t[2*n+o]>a&&I(s,t,e,n);c<i;){for(I(s,t,c,i),c++,i--;t[2*c+o]<a;)c++;for(;t[2*i+o]>a;)i--}t[2*e+o]===a?I(s,t,e,i):(i++,I(s,t,i,n)),i<=r&&(e=i+1),r<=i&&(n=i-1)}}function I(s,t,r,e){V(s,r,e),V(t,2*r,2*e),V(t,2*r+1,2*e+1)}function V(s,t,r){let e=s[t];s[t]=s[r],s[r]=e}function dt(s,t,r,e){let n=s-r,o=t-e;return n*n+o*o}var ie={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:s=>s},mt=Math.fround||(s=>(t=>(s[0]=+t,s[0])))(new Float32Array(1)),O=2,T=3,K=4,x=5,wt=6,D=class{constructor(t){this.options=Object.assign(Object.create(ie),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){let{log:r,minZoom:e,maxZoom:n}=this.options;r&&console.time("total time");let o=`prepare ${t.length} points`;r&&console.time(o),this.points=t;let a=[];for(let i=0;i<t.length;i++){let p=t[i];if(!p.geometry)continue;let[f,h]=p.geometry.coordinates,d=mt(N(f)),l=mt(Z(h));a.push(d,l,1/0,i,-1,1),this.options.reduce&&a.push(0)}let c=this.trees[n+1]=this._createTree(a);r&&console.timeEnd(o);for(let i=n;i>=e;i--){let p=+Date.now();c=this.trees[i]=this._createTree(this._cluster(c,i)),r&&console.log("z%d: %d clusters in %dms",i,c.numItems,+Date.now()-p)}return r&&console.timeEnd("total time"),this}getClusters(t,r){let e=((t[0]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,t[1])),o=t[2]===180?180:((t[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)e=-180,o=180;else if(e>o){let h=this.getClusters([e,n,180,a],r),d=this.getClusters([-180,n,o,a],r);return h.concat(d)}let c=this.trees[this._limitZoom(r)],i=c.range(N(e),Z(a),N(o),Z(n)),p=c.data,f=[];for(let h of i){let d=this.stride*h;f.push(p[d+x]>1?yt(p,d,this.clusterProps):this.points[p[d+T]])}return f}getChildren(t){let r=this._getOriginId(t),e=this._getOriginZoom(t),n="No cluster with the specified id.",o=this.trees[e];if(!o)throw new Error(n);let a=o.data;if(r*this.stride>=a.length)throw new Error(n);let c=this.options.radius/(this.options.extent*Math.pow(2,e-1)),i=a[r*this.stride],p=a[r*this.stride+1],f=o.within(i,p,c),h=[];for(let d of f){let l=d*this.stride;a[l+K]===t&&h.push(a[l+x]>1?yt(a,l,this.clusterProps):this.points[a[l+T]])}if(h.length===0)throw new Error(n);return h}getLeaves(t,r,e){r=r||10,e=e||0;let n=[];return this._appendLeaves(n,t,r,e,0),n}getTile(t,r,e){let n=this.trees[this._limitZoom(t)],o=Math.pow(2,t),{extent:a,radius:c}=this.options,i=c/a,p=(e-i)/o,f=(e+1+i)/o,h={features:[]};return this._addTileFeatures(n.range((r-i)/o,p,(r+1+i)/o,f),n.data,r,e,o,h),r===0&&this._addTileFeatures(n.range(1-i/o,p,1,f),n.data,o,e,o,h),r===o-1&&this._addTileFeatures(n.range(0,p,i/o,f),n.data,-1,e,o,h),h.features.length?h:null}getClusterExpansionZoom(t){let r=this._getOriginZoom(t)-1;for(;r<=this.options.maxZoom;){let e=this.getChildren(t);if(r++,e.length!==1)break;t=e[0].properties.cluster_id}return r}_appendLeaves(t,r,e,n,o){let a=this.getChildren(r);for(let c of a){let i=c.properties;if(i&&i.cluster?o+i.point_count<=n?o+=i.point_count:o=this._appendLeaves(t,i.cluster_id,e,n,o):o<n?o++:t.push(c),t.length===e)break}return o}_createTree(t){let r=new j(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)r.add(t[e],t[e+1]);return r.finish(),r.data=t,r}_addTileFeatures(t,r,e,n,o,a){for(let c of t){let i=c*this.stride,p=r[i+x]>1,f,h,d;if(p)f=Et(r,i,this.clusterProps),h=r[i],d=r[i+1];else{let w=this.points[r[i+T]];f=w.properties;let[u,g]=w.geometry.coordinates;h=N(u),d=Z(g)}let l={type:1,geometry:[[Math.round(this.options.extent*(h*o-e)),Math.round(this.options.extent*(d*o-n))]],tags:f},m;p||this.options.generateId?m=r[i+T]:m=this.points[r[i+T]].id,m!==void 0&&(l.id=m),a.features.push(l)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,r){let{radius:e,extent:n,reduce:o,minPoints:a}=this.options,c=e/(n*Math.pow(2,r)),i=t.data,p=[],f=this.stride;for(let h=0;h<i.length;h+=f){if(i[h+O]<=r)continue;i[h+O]=r;let d=i[h],l=i[h+1],m=t.within(i[h],i[h+1],c),w=i[h+x],u=w;for(let g of m){let y=g*f;i[y+O]>r&&(u+=i[y+x])}if(u>w&&u>=a){let g=d*w,y=l*w,E,M=-1,_=((h/f|0)<<5)+(r+1)+this.points.length;for(let k of m){let v=k*f;if(i[v+O]<=r)continue;i[v+O]=r;let it=i[v+x];g+=i[v]*it,y+=i[v+1]*it,i[v+K]=_,o&&(E||(E=this._map(i,h,!0),M=this.clusterProps.length,this.clusterProps.push(E)),o(E,this._map(i,v)))}i[h+K]=_,p.push(g/u,y/u,1/0,_,-1,u),o&&p.push(M)}else{for(let g=0;g<f;g++)p.push(i[h+g]);if(u>1)for(let g of m){let y=g*f;if(!(i[y+O]<=r)){i[y+O]=r;for(let E=0;E<f;E++)p.push(i[y+E])}}}}return p}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,r,e){if(t[r+x]>1){let a=this.clusterProps[t[r+wt]];return e?Object.assign({},a):a}let n=this.points[t[r+T]].properties,o=this.options.map(n);return e&&o===n?Object.assign({},o):o}};function yt(s,t,r){return{type:"Feature",id:s[t+T],properties:Et(s,t,r),geometry:{type:"Point",coordinates:[ae(s[t]),ce(s[t+1])]}}}function Et(s,t,r){let e=s[t+x],n=e>=1e4?`${Math.round(e/1e3)}k`:e>=1e3?`${Math.round(e/100)/10}k`:e,o=s[t+wt],a=o===-1?{}:Object.assign({},r[o]);return Object.assign(a,{cluster:!0,cluster_id:s[t+T],point_count:e,point_count_abbreviated:n})}function N(s){return s/360+.5}function Z(s){let t=Math.sin(s*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function ae(s){return(s-.5)*360}function ce(s){let t=(180-s*360)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function le(s,t){var r={};for(var e in s)Object.prototype.hasOwnProperty.call(s,e)&&t.indexOf(e)<0&&(r[e]=s[e]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,e=Object.getOwnPropertySymbols(s);n<e.length;n++)t.indexOf(e[n])<0&&Object.prototype.propertyIsEnumerable.call(s,e[n])&&(r[e[n]]=s[e[n]]);return r}var A=class{static isAdvancedMarkerAvailable(t){return google.maps.marker&&t.getMapCapabilities().isAdvancedMarkersAvailable===!0}static isAdvancedMarker(t){return google.maps.marker&&t instanceof google.maps.marker.AdvancedMarkerElement}static setMap(t,r){this.isAdvancedMarker(t)?t.map=r:t.setMap(r)}static getPosition(t){if(this.isAdvancedMarker(t)){if(t.position){if(t.position instanceof google.maps.LatLng)return t.position;if(Number.isFinite(t.position.lat)&&Number.isFinite(t.position.lng))return new google.maps.LatLng(t.position.lat,t.position.lng)}return new google.maps.LatLng(null)}return t.getPosition()}static getVisible(t){return this.isAdvancedMarker(t)?!0:t.getVisible()}},R=class{constructor({markers:t,position:r}){this.markers=[],t&&(this.markers=t),r&&(r instanceof google.maps.LatLng?this._position=r:this._position=new google.maps.LatLng(r))}get bounds(){if(this.markers.length===0&&!this._position)return;let t=new google.maps.LatLngBounds(this._position,this._position);for(let r of this.markers)t.extend(A.getPosition(r));return t}get position(){return this._position||this.bounds.getCenter()}get count(){return this.markers.filter(t=>A.getVisible(t)).length}push(t){this.markers.push(t)}delete(){this.marker&&(A.setMap(this.marker,null),this.marker=void 0),this.markers.length=0}};function J(s,t="assertion failed"){if(s==null)throw Error(t)}var Y=class{constructor({maxZoom:t=16}){this.maxZoom=t}noop({markers:t}){return ue(t)}};var ue=s=>s.map(r=>new R({position:A.getPosition(r),markers:[r]}));var H=class extends Y{constructor(t){var{maxZoom:r,radius:e=60}=t,n=le(t,["maxZoom","radius"]);super({maxZoom:r}),this.markers=[],this.clusters=[],this.state={zoom:-1},this.superCluster=new D(Object.assign({maxZoom:this.maxZoom,radius:e},n))}calculate(t){let r=!1,e=t.map.getZoom();J(e),e=Math.round(e);let n={zoom:e};if(!z(t.markers,this.markers)){r=!0,this.markers=[...t.markers];let o=this.markers.map(a=>{let c=A.getPosition(a);return{type:"Feature",geometry:{type:"Point",coordinates:[c.lng(),c.lat()]},properties:{marker:a}}});this.superCluster.load(o)}return r||(this.state.zoom<=this.maxZoom||n.zoom<=this.maxZoom)&&(r=!z(this.state,n)),this.state=n,t.markers.length===0?(this.clusters=[],{clusters:this.clusters,changed:r}):(r&&(this.clusters=this.cluster(t)),{clusters:this.clusters,changed:r})}cluster({map:t}){let r=t.getZoom();return J(r),this.superCluster.getClusters([-180,-90,180,90],Math.round(r)).map(e=>this.transformCluster(e))}transformCluster({geometry:{coordinates:[t,r]},properties:e}){if(e.cluster)return new R({markers:this.superCluster.getLeaves(e.cluster_id,1/0).map(o=>o.properties.marker),position:{lat:r,lng:t}});let n=e.marker;return new R({markers:[n],position:A.getPosition(n)})}};var X=class{constructor(t,r){this.markers={sum:t.length};let e=r.map(o=>o.count),n=e.reduce((o,a)=>o+a,0);this.clusters={count:r.length,markers:{mean:n/r.length,sum:n,min:Math.min(...e),max:Math.max(...e)}}}},Q=class{render({count:t,position:r},e,n){let a=`<svg fill="${t>Math.max(10,e.clusters.markers.mean)?"#ff0000":"#0000ff"}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240" width="50" height="50">
<circle cx="120" cy="120" opacity=".6" r="70" />
<circle cx="120" cy="120" opacity=".3" r="90" />
<circle cx="120" cy="120" opacity=".2" r="110" />
<text x="50%" y="50%" style="fill:#fff" text-anchor="middle" font-size="50" dominant-baseline="middle" font-family="roboto,arial,sans-serif">${t}</text>
</svg>`,c=`Cluster of ${t} markers`,i=Number(google.maps.Marker.MAX_ZINDEX)+t;if(A.isAdvancedMarkerAvailable(n)){let h=new DOMParser().parseFromString(a,"image/svg+xml").documentElement;h.setAttribute("transform","translate(0 25)");let d={map:n,position:r,zIndex:i,title:c,content:h};return new google.maps.marker.AdvancedMarkerElement(d)}let p={position:r,zIndex:i,title:c,icon:{url:`data:image/svg+xml;base64,${btoa(a)}`,anchor:new google.maps.Point(25,25)}};return new google.maps.Marker(p)}};function he(s,t){for(let r in t.prototype)s.prototype[r]=t.prototype[r]}var tt=class s{constructor(){he(s,google.maps.OverlayView)}},C;(function(s){s.CLUSTERING_BEGIN="clusteringbegin",s.CLUSTERING_END="clusteringend",s.CLUSTER_CLICK="click",s.GMP_CLICK="gmp-click"})(C||(C={}));var fe=(s,t,r)=>{t.bounds&&r.fitBounds(t.bounds)},F=class extends tt{constructor({map:t,markers:r=[],algorithmOptions:e={},algorithm:n=new H(e),renderer:o=new Q,onClusterClick:a=fe}){super(),this.map=null,this.idleListener=null,this.markers=[...r],this.clusters=[],this.algorithm=n,this.renderer=o,this.onClusterClick=a,t&&this.setMap(t)}addMarker(t,r){this.markers.includes(t)||(this.markers.push(t),r||this.render())}addMarkers(t,r){t.forEach(e=>{this.addMarker(e,!0)}),r||this.render()}removeMarker(t,r){let e=this.markers.indexOf(t);return e===-1?!1:(A.setMap(t,null),this.markers.splice(e,1),r||this.render(),!0)}removeMarkers(t,r){let e=!1;return t.forEach(n=>{e=this.removeMarker(n,!0)||e}),e&&!r&&this.render(),e}clearMarkers(t){this.markers.length=0,t||this.render()}render(){let t=this.getMap();if(t instanceof google.maps.Map&&t.getProjection()){google.maps.event.trigger(this,C.CLUSTERING_BEGIN,this);let{clusters:r,changed:e}=this.algorithm.calculate({markers:this.markers,map:t,mapCanvasProjection:this.getProjection()});if(e||e==null){let n=new Set;for(let a of r)a.markers.length==1&&n.add(a.markers[0]);let o=[];for(let a of this.clusters)a.marker!=null&&(a.markers.length==1?n.has(a.marker)||A.setMap(a.marker,null):o.push(a.marker));this.clusters=r,this.renderClusters(),requestAnimationFrame(()=>o.forEach(a=>A.setMap(a,null)))}google.maps.event.trigger(this,C.CLUSTERING_END,this)}}onAdd(){let t=this.getMap();J(t),this.idleListener=t.addListener("idle",this.render.bind(this)),this.render()}onRemove(){this.idleListener&&google.maps.event.removeListener(this.idleListener),this.reset()}reset(){this.markers.forEach(t=>A.setMap(t,null)),this.clusters.forEach(t=>t.delete()),this.clusters=[]}renderClusters(){let t=new X(this.markers,this.clusters),r=this.getMap();this.clusters.forEach(e=>{if(e.markers.length===1)e.marker=e.markers[0];else if(e.marker=this.renderer.render(e,t,r),e.markers.forEach(n=>A.setMap(n,null)),this.onClusterClick){let n=A.isAdvancedMarker(e.marker)?C.GMP_CLICK:C.CLUSTER_CLICK;e.marker.addListener(n,o=>{google.maps.event.trigger(this,C.CLUSTER_CLICK,e),this.onClusterClick(o,e,r)})}A.setMap(e.marker,r)})}};function et(s,t){return t=t==null?s.length-1:+t,function(){for(var r=Math.max(arguments.length-t,0),e=Array(r),n=0;n<r;n++)e[n]=arguments[n+t];switch(t){case 0:return s.call(this,e);case 1:return s.call(this,arguments[0],e);case 2:return s.call(this,arguments[0],arguments[1],e)}var o=Array(t+1);for(n=0;n<t;n++)o[n]=arguments[n];return o[t]=e,s.apply(this,o)}}var rt=Date.now||function(){return new Date().getTime()};function st(s,t,r){var e,n,o,a,c,i=function(){var f=rt()-n;t>f?e=setTimeout(i,t-f):(e=null,r||(a=s.apply(c,o)),e||(o=c=null))},p=et(function(f){return c=this,o=f,n=rt(),e||(e=setTimeout(i,t),r&&(a=s.apply(c,o))),a});return p.cancel=function(){clearTimeout(e),e=o=c=null},p}function pe(s,t){s.src=t}var de=s=>{var t,r,e,n="The Google Maps JavaScript API",o="google",a="importLibrary",c="__ib__",i=document,p=window,f=p[o]||(p[o]={}),h=f.maps||(f.maps={}),d=new Set,l=new URLSearchParams,m=()=>t||(t=new Promise(async(w,u)=>{await(r=i.createElement("script")),l.set("libraries",[...d]+"");for(e in s)l.set(e.replace(/[A-Z]/g,g=>"_"+g[0].toLowerCase()),s[e]);l.set("callback",o+".maps."+c),pe(r,"https://maps.googleapis.com/maps/api/js?"+l),h[c]=w,r.onerror=()=>t=u(Error(n+" could not load.")),r.nonce=i.querySelector("script[nonce]")?.nonce||"",i.head.append(r)}));h[a]?console.warn(n+" only loads once. Ignoring:",s):h[a]=(w,...u)=>d.add(w)&&m().then(()=>h[a](w,...u))};var ge=s=>`The setOptions() function should only be called once. The options passed to the additional call (${JSON.stringify(s)}) will be ignored.`,me=s=>`The google.maps.importLibrary() function is already defined, and @googlemaps/js-api-loader will use the existing function instead of overwriting it. The options passed to setOptions (${JSON.stringify(s)}) will be ignored.`,ye="No options were set before calling importLibrary. Make sure to configure the loader using setOptions().",we="There already is a script loading the Google Maps JavaScript API, and no google.maps.importLibrary function is defined. @googlemaps/js-api-loader will proceed to bootstrap the API with the specified options, but the existing script might cause problems using the API. Make sure to remove the script loading the API.",Mt=!1,ot=Mt?s=>{console.warn(`[@googlemaps/js-api-loader] ${s}`)}:()=>{},Ee=Mt?s=>{console.info(`[@googlemaps/js-api-loader] ${s}`)}:()=>{};var Me=!1,nt=!1;function _t(s){if(nt){ot(ge(s));return}_e(s),nt=!0}async function U(s){if(nt||ot(ye),!window?.google?.maps?.importLibrary)throw new Error("google.maps.importLibrary is not installed.");return await google.maps.importLibrary(s)}function _e(s){let t=!!window.google?.maps?.importLibrary;t?Ee(me(s)):Me&&document.querySelector('script[src*="maps.googleapis.com/maps/api/js"]')&&ot(we),t||de(s)}function Ae({apiKey:s,cachedData:t,config:r,mapEl:e}){let n=null,o=null,a=null,c=[],i=[],p=[],f=null,h=null,d={center:{lat:0,lng:0},clustering:!1,controls:{mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0,searchBoxControl:!1,zoomControl:!1},fit:!0,mapIsFilter:!1,gmaps:"",layers:[],zoom:12,markerAction:null,mapConfig:[]};return{mapEl:null,init:function(){e=document.getElementById(e)||e,a=t,d={...d,...r},this.createMap()},callWire:function(l){},async createMap(){_t({key:s});let{Map:l}=await U("maps"),{PlacesService:m}=await U("places"),{AdvancedMarkerElement:w}=await U("marker");o=new google.maps.InfoWindow({content:"",disableAutoPan:!0}),n=new l(e,{mapId:e.id,center:d.center,zoom:d.zoom,...d.controls,...d.mapConfig}),h=d.center,this.createMarkers(),this.createClustering(),this.createLayers(),this.idle(),window.addEventListener("filament-google-maps::widget/setMapCenter",u=>{this.recenter(u.detail)}),this.show(!0)},show:function(l=!1){c.length>0&&d.fit?this.fitToBounds(l):c.length>0?n.setCenter(c[0].getPosition()):n.setCenter(d.center)},createLayers:function(){i=d.layers.map(l=>new google.maps.KmlLayer({url:l,map:n}))},createMarker:function(l){let m;l.icon&&typeof l.icon=="object"&&l.icon.hasOwnProperty("url")&&(m={url:l.icon.url},l.icon.hasOwnProperty("type")&&l.icon.type==="svg"&&l.icon.hasOwnProperty("scale")&&(m.scaledSize=new google.maps.Size(l.icon.scale[0],l.icon.scale[1])));let w=l.location,u=l.label,g=new google.maps.Marker({position:w,title:u,model_id:l.id,...m&&{icon:m}});return p.indexOf(l.id)===-1&&p.push(l.id),g},createMarkers:function(){c=a.map(l=>{let m=this.createMarker(l);return m.setMap(n),d.markerAction&&google.maps.event.addListener(m,"click",w=>{this.$wire.mountAction(d.markerAction,{model_id:m.model_id})}),m})},removeMarker:function(l){l.setMap(null)},removeMarkers:function(){for(let l=0;l<c.length;l++)c[l].setMap(null);c=[]},mergeMarkers:function(){let l=(E,M,_=!1)=>E.filter(k=>_===M.some(v=>k.getPosition().lat()===v.getPosition().lat()&&k.getPosition().lng()===v.getPosition().lng())),m=(E,M)=>l(E,M,!0),w=l,u=(E,M)=>w(M,E),g=a.map(E=>{let M=this.createMarker(E);return M.addListener("click",()=>{o.setContent(E.label),o.open(n,M)}),M});if(!d.mapIsFilter){let E=u(g,c);for(let M=E.length-1;M>=0;M--){E[M].setMap(null);let _=c.findIndex(k=>k.getPosition().lat()===E[M].getPosition().lat()&&k.getPosition().lng()===E[M].getPosition().lng());c.splice(_,1)}}let y=u(c,g);for(let E=0;E<y.length;E++)y[E].setMap(n),c.push(y[E]);this.fitToBounds()},fitToBounds:function(l=!1){if(c.length>0&&d.fit&&(l||!d.mapIsFilter)){this.bounds=new google.maps.LatLngBounds;for(let m of c)this.bounds.extend(m.getPosition());n.fitBounds(this.bounds)}},createClustering:function(){c.length>0&&d.clustering&&(f=new F({map:n,markers:c}))},updateClustering:function(){d.clustering&&(f.clearMarkers(),f.addMarkers(c))},moved:function(){function l(g,y){return g.length===y.length?g.every((E,M)=>E===y[M]):!1}console.log("moved");let m=n.getBounds(),u=c.filter(g=>m.contains(g.getPosition())).map(g=>g.model_id);l(p,u)||(p=u,console.log(u),this.$wire.set("mapFilterIds",u))},idle:function(){if(d.mapIsFilter){let l=self,m=st(this.moved,1e3).bind(this);google.maps.event.addListener(n,"idle",w=>{if(self.isMapDragging){self.idleSkipped=!0;return}self.idleSkipped=!1,m()}),google.maps.event.addListener(n,"dragstart",w=>{self.isMapDragging=!0}),google.maps.event.addListener(n,"dragend",w=>{self.isMapDragging=!1,self.idleSkipped===!0&&(m(),self.idleSkipped=!1)}),google.maps.event.addListener(n,"bounds_changed",w=>{self.idleSkipped=!1})}},update:function(l){l=l,this.mergeMarkers(),this.updateClustering(),this.show()},recenter:function(l){n.panTo({lat:l.lat,lng:l.lng}),n.setZoom(l.zoom)}}}export{Ae as default};
